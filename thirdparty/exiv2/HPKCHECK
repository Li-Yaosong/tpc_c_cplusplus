# Contributor: lpzhong <278527840@qq.com>
# Maintainer: lpzhong <278527840@qq.com>

source HPKBUILD > /dev/null 2>&1
logfile=${LYCIUM_THIRDPARTY_ROOT}/${pkgname}/${pkgname}_${ARCH}_${OHOS_SDK_VER}_test.log
openharmonycheck() {
    res=1
    cd ${builddir}/${ARCH}-build

    # 由于ctest测试使用到了python无法在开发板中正常测试，因此使用sample测试
    # 读取iptc
    ./bin/exiv2 -pi ../../exiv2.jpg > $logfile 2>&1
    res1=$?
    # 添加iptc
    ./bin/exiv2 -M "add Iptc.Application2.Credit String mee too!" ../../exiv2.jpg >> $logfile 2>&1
    res2=$?
    # 修改iptc
    ./bin/exiv2 -M "set Iptc.Application2.Credit String mee test!" ../../exiv2.jpg >> $logfile 2>&1
    res3=$?
    # 删除iptc
    ./bin/exiv2 -M "del Iptc.Application2.Credit" ../../exiv2.jpg >> $logfile 2>&1
    res4=$?
    # 读取xmp
    ./bin/exiv2 -px ../../exiv2.jpg >> $logfile 2>&1
    res5=$?
    # 添加xmp
    ./bin/exiv2 -M "add Xmp.dc.format XmpText image/jpeg" ../../exiv2.jpg >> $logfile 2>&1
    res6=$?
    # 修改xmp
    ./bin/exiv2 -M "set Xmp.dc.format XmpText image/png" ../../exiv2.jpg >> $logfile 2>&1
    res7=$?
    # 删除xmp
    ./bin/exiv2 -M "del Xmp.dc.format" ../../exiv2.jpg >> $logfile 2>&1
    res8=$?
    # 读取exif
    ./bin/exiv2 -pe ../../exiv2.jpg >> $logfile 2>&1
    res9=$?
    # 添加exif
    ./bin/exiv2 -M "add Exif.Image.WhitePoint Short 32 12 4 5 6" ../../exiv2.jpg >> $logfile 2>&1
    res10=$?
    # 修改exif
    ./bin/exiv2 -M "set Exif.Image.WhitePoint Short 10" ../../exiv2.jpg >> $logfile 2>&1
    res11=$?
    # 删除exif
    ./bin/exiv2 -M "del Exif.Image.WhitePoint" ../../exiv2.jpg >> $logfile 2>&1
    res12=$?
    # 读取icc
    ./bin/exiv2 -b -pC ../../exiv2.jpg >> $logfile 2>&1
    res13=$?
    # 添加或修改icc(添加或修改icc文件时，注意icc文件名要和当前的图片的名字保持一致,.icc文件放在和图片文件同目录下)
    ./bin/exiv2 -iC ../../exiv2.jpg >> $logfile 2>&1
    res14=$?
    # 删除icc
    ./bin/exiv2 -dC ../../exiv2.jpg >> $logfile 2>&1
    res15=$?

    cd $OLDPWD
    if [ $res1 -eq 0 ] && [ $res2 -eq 0 ] && [ $res3 -eq 0 ] && [ $res4 -eq 0 ] && [ $res5 -eq 0 ] && [ $res6 -eq 0 ] && [ $res7 -eq 0 ] && [ $res8 -eq 0 ] && [ $res9 -eq 0 ] && [ $res10 -eq 0 ] && [ $res11 -eq 0 ] && [ $res12 -eq 0 ] && [ $res13 -eq 0 ] && [ $res14 -eq 0 ] && [ $res15 -eq 0 ]
    then
        res=0
    fi
    return $res
}
